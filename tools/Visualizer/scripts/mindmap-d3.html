<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Map - D3.js Radial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --background: #ffffff;
            --surface: #f8fafc;
            --text: #1e293b;
            --text-muted: #64748b;
            --branch-1: #10b981;
            --branch-2: #8b5cf6;
            --branch-3: #f59e0b;
            --branch-4: #ef4444;
            --branch-5: #ec4899;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            color: var(--text);
            background: var(--surface);
            padding: 20px;
        }

        .header {
            max-width: 1400px;
            margin: 0 auto 20px;
            text-align: center;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 18px;
        }

        .controls {
            max-width: 1400px;
            margin: 0 auto 20px;
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        button:hover {
            background: var(--primary-light);
        }

        .visualization-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: auto;
        }

        #mindmap {
            width: 100%;
            height: calc(100vh - 240px);
            min-height: 600px;
        }

        .node circle {
            stroke: white;
            stroke-width: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .node circle:hover {
            stroke-width: 4px;
        }

        .node.center circle {
            fill: var(--primary);
            r: 40;
        }

        .node.collapsed circle {
            fill: var(--text-muted);
        }

        .node text {
            font-size: 14px;
            font-weight: 500;
            fill: var(--text);
            pointer-events: none;
        }

        .node.center text {
            font-size: 18px;
            font-weight: 600;
        }

        .link {
            fill: none;
            stroke-width: 2px;
            opacity: 0.6;
        }

        .instructions {
            max-width: 1400px;
            margin: 20px auto 0;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .instructions h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .instructions ul {
            margin-left: 20px;
            color: var(--text-muted);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Mind Map Template</h1>
        <p class="subtitle">Interactive radial concept visualization</p>
    </div>

    <div class="controls">
        <button onclick="expandAll()">Expand All</button>
        <button onclick="collapseAll()">Collapse All</button>
        <button onclick="resetView()">Reset View</button>
        <button onclick="exportSVG()">Export SVG</button>
    </div>

    <div class="visualization-container">
        <svg id="mindmap"></svg>
    </div>

    <div class="instructions">
        <h3>How to Use This Template:</h3>
        <ul>
            <li>Modify the <code>data</code> structure below - one central concept with radiating branches</li>
            <li>Each top-level child gets its own color automatically</li>
            <li>Click nodes to collapse/expand branches</li>
            <li>Best for single central idea with multiple themes branching out</li>
            <li>Keep branches relatively balanced for best visual effect</li>
        </ul>
    </div>

    <script>
        // =================================================================
        // DATA STRUCTURE - MODIFY THIS SECTION
        // =================================================================

        const data = {
            name: "AI First Principles",
            children: [
                {
                    name: "Build from User Experience",
                    children: [
                        { name: "Observe actual workflows" },
                        { name: "Test with real users" },
                        { name: "Measure friction points" }
                    ]
                },
                {
                    name: "Iterate Towards What Works",
                    children: [
                        { name: "Experiment continuously" },
                        { name: "Learn from failures" },
                        { name: "Adapt based on evidence" }
                    ]
                },
                {
                    name: "Reveal the Invisible",
                    children: [
                        { name: "Expose complexity" },
                        { name: "Document decisions" },
                        { name: "Make assumptions explicit" }
                    ]
                },
                {
                    name: "People Own Objectives",
                    children: [
                        { name: "Clear accountability" },
                        { name: "Human oversight" },
                        { name: "Escalation paths" }
                    ]
                },
                {
                    name: "Decompose Incrementally",
                    children: [
                        { name: "Start small" },
                        { name: "Validate quickly" },
                        { name: "Scale what works" }
                    ]
                }
            ]
        };

        // =================================================================
        // VISUALIZATION CODE - NO NEED TO MODIFY
        // =================================================================

        const width = 1400;
        const height = 800;
        const radius = Math.min(width, height) / 2 - 120;

        const branchColors = [
            'var(--branch-1)', 'var(--branch-2)', 'var(--branch-3)', 
            'var(--branch-4)', 'var(--branch-5)'
        ];

        const svg = d3.select('#mindmap')
            .attr('width', width)
            .attr('height', height);

        const g = svg.append('g')
            .attr('transform', `translate(${width / 2}, ${height / 2})`);

        const zoom = d3.zoom()
            .scaleExtent([0.3, 3])
            .on('zoom', (event) => {
                g.attr('transform', `translate(${width / 2}, ${height / 2}) ${event.transform}`);
            });
        svg.call(zoom);

        const tree = d3.tree()
            .size([2 * Math.PI, radius])
            .separation((a, b) => (a.parent == b.parent ? 1 : 2) / a.depth);

        let root = d3.hierarchy(data);

        function getBranchColor(node) {
            // Find the top-level ancestor
            let current = node;
            while (current.depth > 1) {
                current = current.parent;
            }
            if (current.depth === 0) return getComputedStyle(document.documentElement).getPropertyValue('--primary');
            
            const index = root.children.indexOf(current);
            return branchColors[index % branchColors.length];
        }

        function update() {
            g.selectAll('*').remove();

            const treeData = tree(root);
            const nodes = treeData.descendants();
            const links = treeData.links();

            // Draw links
            const link = g.selectAll('.link')
                .data(links)
                .join('path')
                .attr('class', 'link')
                .attr('d', d3.linkRadial()
                    .angle(d => d.x)
                    .radius(d => d.y))
                .style('stroke', d => getBranchColor(d.target));

            // Draw nodes
            const node = g.selectAll('.node')
                .data(nodes)
                .join('g')
                .attr('class', d => `node ${d.depth === 0 ? 'center' : ''} ${d._children ? 'collapsed' : ''}`)
                .attr('transform', d => `rotate(${d.x * 180 / Math.PI - 90}) translate(${d.y},0)`)
                .on('click', (event, d) => {
                    if (d.children || d._children) {
                        if (d.children) {
                            d._children = d.children;
                            d.children = null;
                        } else {
                            d.children = d._children;
                            d._children = null;
                        }
                        update();
                    }
                });

            node.append('circle')
                .attr('r', d => d.depth === 0 ? 40 : (d.children || d._children ? 8 : 5))
                .style('fill', d => d.depth === 0 ? getComputedStyle(document.documentElement).getPropertyValue('--primary') : getBranchColor(d));

            node.append('text')
                .attr('dy', '0.31em')
                .attr('x', d => {
                    if (d.depth === 0) return 0;
                    return d.x < Math.PI === !d.children ? 12 : -12;
                })
                .attr('text-anchor', d => {
                    if (d.depth === 0) return 'middle';
                    return d.x < Math.PI === !d.children ? 'start' : 'end';
                })
                .attr('transform', d => {
                    if (d.depth === 0) return null;
                    return d.x >= Math.PI ? 'rotate(180)' : null;
                })
                .text(d => d.data.name)
                .style('fill', d => d.depth === 0 ? 'white' : 'var(--text)');
        }

        function expandAll() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            update();
        }

        function collapseAll() {
            root.descendants().forEach(d => {
                if (d.children && d.depth > 0) {
                    d._children = d.children;
                    d.children = null;
                }
            });
            update();
        }

        function resetView() {
            svg.transition()
                .duration(750)
                .call(zoom.transform, d3.zoomIdentity);
        }

        // SVG Export function
        function exportSVG() {
            const svgElement = document.getElementById('mindmap');
            const clone = svgElement.cloneNode(true);
            
            // Get computed styles
            const computedStyles = getComputedStyle(document.documentElement);
            const cssVars = {
                '--primary': computedStyles.getPropertyValue('--primary').trim(),
                '--text': computedStyles.getPropertyValue('--text').trim(),
                '--branch-1': computedStyles.getPropertyValue('--branch-1').trim(),
                '--branch-2': computedStyles.getPropertyValue('--branch-2').trim(),
                '--branch-3': computedStyles.getPropertyValue('--branch-3').trim(),
                '--branch-4': computedStyles.getPropertyValue('--branch-4').trim(),
                '--branch-5': computedStyles.getPropertyValue('--branch-5').trim()
            };
            
            // Add inline styles
            const styleElement = document.createElementNS('http://www.w3.org/2000/svg', 'style');
            styleElement.textContent = `
                .node circle { stroke: white; stroke-width: 3px; }
                .node text { font-family: system-ui, -apple-system, sans-serif; font-size: 14px; font-weight: 500; }
                .node.center text { font-size: 18px; font-weight: 600; }
                .link { fill: none; stroke-width: 2px; opacity: 0.6; }
            `;
            clone.insertBefore(styleElement, clone.firstChild);
            
            // Replace CSS variables in style attributes
            clone.querySelectorAll('[style*="var("]').forEach(el => {
                let style = el.getAttribute('style');
                style = style.replace(/var\(--primary\)/g, cssVars['--primary']);
                style = style.replace(/var\(--text\)/g, cssVars['--text']);
                style = style.replace(/var\(--branch-1\)/g, cssVars['--branch-1']);
                style = style.replace(/var\(--branch-2\)/g, cssVars['--branch-2']);
                style = style.replace(/var\(--branch-3\)/g, cssVars['--branch-3']);
                style = style.replace(/var\(--branch-4\)/g, cssVars['--branch-4']);
                style = style.replace(/var\(--branch-5\)/g, cssVars['--branch-5']);
                el.setAttribute('style', style);
            });
            
            const serializer = new XMLSerializer();
            let svgString = serializer.serializeToString(clone);
            svgString = '<?xml version="1.0" encoding="UTF-8"?>\n' + svgString;
            
            const blob = new Blob([svgString], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'mindmap.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Initial render
        update();
    </script>
</body>
</html>
