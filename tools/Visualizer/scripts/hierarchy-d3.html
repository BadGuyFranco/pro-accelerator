<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchy - D3.js Tree</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --background: #ffffff;
            --surface: #f8fafc;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            color: var(--text);
            background: var(--surface);
            padding: 20px;
        }

        .header {
            max-width: 1400px;
            margin: 0 auto 20px;
            text-align: center;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 18px;
        }

        .controls {
            max-width: 1400px;
            margin: 0 auto 20px;
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
        }

        button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        button:hover {
            background: var(--primary-light);
        }

        select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }

        .visualization-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: auto;
        }

        #tree {
            width: 100%;
            height: calc(100vh - 260px);
            min-height: 600px;
        }

        .node circle {
            fill: var(--primary);
            stroke: var(--primary-light);
            stroke-width: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .node circle:hover {
            fill: var(--primary-light);
            stroke-width: 4px;
        }

        .node.collapsed circle {
            fill: var(--text-muted);
            stroke: var(--text);
        }

        .node text {
            font-size: 14px;
            font-weight: 500;
            fill: var(--text);
        }

        .link {
            fill: none;
            stroke: var(--text-muted);
            stroke-width: 2px;
        }

        .instructions {
            max-width: 1400px;
            margin: 20px auto 0;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .instructions h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .instructions ul {
            margin-left: 20px;
            color: var(--text-muted);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Hierarchy Template</h1>
        <p class="subtitle">Interactive hierarchical structure visualization</p>
    </div>

    <div class="controls">
        <label for="orientation" style="font-size: 14px; color: var(--text-muted);">Orientation:</label>
        <select id="orientation">
            <option value="vertical">Vertical (Top-Down)</option>
            <option value="horizontal">Horizontal (Left-Right)</option>
            <option value="radial">Radial (Center-Out)</option>
        </select>
        <button onclick="expandAll()">Expand All</button>
        <button onclick="collapseAll()">Collapse All</button>
        <button onclick="resetView()">Reset View</button>
        <button onclick="exportSVG()">Export SVG</button>
    </div>

    <div class="visualization-container">
        <svg id="tree"></svg>
    </div>

    <div class="instructions">
        <h3>How to Use This Template:</h3>
        <ul>
            <li>Modify the <code>data</code> hierarchy structure below</li>
            <li>Nest children inside <code>children</code> arrays</li>
            <li>Click nodes to collapse/expand branches</li>
            <li>Try different orientations for different use cases</li>
            <li>Radial works well for balanced trees</li>
        </ul>
    </div>

    <script>
        // =================================================================
        // DATA STRUCTURE - MODIFY THIS SECTION
        // =================================================================

        const data = {
            name: "WISER Method",
            children: [
                {
                    name: "Canons",
                    children: [
                        { name: "Witness" },
                        { name: "Interrogate" },
                        { name: "Solve" },
                        { name: "Expand" },
                        { name: "Refine" }
                    ]
                },
                {
                    name: "Components",
                    children: [
                        { name: "Recipes" },
                        { name: "Charter" },
                        {
                            name: "Functions",
                            children: [
                                { name: "Sponsor" },
                                { name: "Architect" },
                                { name: "Sage" },
                                { name: "Scout" },
                                { name: "Smith" },
                                { name: "Sentinel" },
                                { name: "Guide" }
                            ]
                        }
                    ]
                },
                {
                    name: "Principles",
                    children: [
                        { name: "Iteration as Expected" },
                        { name: "Scaffolded Flexibility" },
                        { name: "Strategic Neutrality" }
                    ]
                }
            ]
        };

        // =================================================================
        // VISUALIZATION CODE - NO NEED TO MODIFY
        // =================================================================

        const width = 1400;
        const height = 700;
        const margin = { top: 40, right: 120, bottom: 40, left: 120 };

        const svg = d3.select('#tree')
            .attr('width', width)
            .attr('height', height);

        const g = svg.append('g');

        const zoom = d3.zoom()
            .scaleExtent([0.3, 3])
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });
        svg.call(zoom);

        let root = d3.hierarchy(data);
        let currentOrientation = 'vertical';

        function update() {
            g.selectAll('*').remove();

            const orientation = document.getElementById('orientation').value;
            currentOrientation = orientation;

            if (orientation === 'radial') {
                renderRadial();
            } else {
                renderTree(orientation);
            }
        }

        function renderTree(orientation) {
            const dx = 40;
            const dy = orientation === 'vertical' ? 150 : 200;

            const tree = d3.tree().nodeSize([dx, dy]);
            const treeData = tree(root);

            const nodes = treeData.descendants();
            const links = treeData.links();

            // Adjust positioning based on orientation
            if (orientation === 'vertical') {
                g.attr('transform', `translate(${width / 2}, ${margin.top})`);
            } else {
                g.attr('transform', `translate(${margin.left}, ${height / 2})`);
            }

            // Draw links
            const link = g.selectAll('.link')
                .data(links)
                .join('path')
                .attr('class', 'link')
                .attr('d', d => {
                    if (orientation === 'vertical') {
                        return `M${d.source.x},${d.source.y}
                                C${d.source.x},${(d.source.y + d.target.y) / 2}
                                 ${d.target.x},${(d.source.y + d.target.y) / 2}
                                 ${d.target.x},${d.target.y}`;
                    } else {
                        return `M${d.source.y},${d.source.x}
                                C${(d.source.y + d.target.y) / 2},${d.source.x}
                                 ${(d.source.y + d.target.y) / 2},${d.target.x}
                                 ${d.target.y},${d.target.x}`;
                    }
                });

            // Draw nodes
            const node = g.selectAll('.node')
                .data(nodes)
                .join('g')
                .attr('class', d => `node ${d.children || d._children ? 'internal' : 'leaf'} ${d._children ? 'collapsed' : ''}`)
                .attr('transform', d => orientation === 'vertical' 
                    ? `translate(${d.x},${d.y})`
                    : `translate(${d.y},${d.x})`)
                .on('click', (event, d) => {
                    if (d.children || d._children) {
                        if (d.children) {
                            d._children = d.children;
                            d.children = null;
                        } else {
                            d.children = d._children;
                            d._children = null;
                        }
                        update();
                    }
                });

            node.append('circle')
                .attr('r', 6);

            node.append('text')
                .attr('dy', orientation === 'vertical' ? '1.5em' : '0.31em')
                .attr('x', orientation === 'vertical' ? 0 : d => d.children || d._children ? -12 : 12)
                .attr('text-anchor', orientation === 'vertical' ? 'middle' : d => d.children || d._children ? 'end' : 'start')
                .text(d => d.data.name);
        }

        function renderRadial() {
            const radius = Math.min(width, height) / 2 - margin.top;

            const tree = d3.tree()
                .size([2 * Math.PI, radius])
                .separation((a, b) => (a.parent == b.parent ? 1 : 2) / a.depth);

            const treeData = tree(root);
            const nodes = treeData.descendants();
            const links = treeData.links();

            g.attr('transform', `translate(${width / 2}, ${height / 2})`);

            // Draw links
            const link = g.selectAll('.link')
                .data(links)
                .join('path')
                .attr('class', 'link')
                .attr('d', d3.linkRadial()
                    .angle(d => d.x)
                    .radius(d => d.y));

            // Draw nodes
            const node = g.selectAll('.node')
                .data(nodes)
                .join('g')
                .attr('class', d => `node ${d.children || d._children ? 'internal' : 'leaf'} ${d._children ? 'collapsed' : ''}`)
                .attr('transform', d => `rotate(${d.x * 180 / Math.PI - 90}) translate(${d.y},0)`)
                .on('click', (event, d) => {
                    if (d.children || d._children) {
                        if (d.children) {
                            d._children = d.children;
                            d.children = null;
                        } else {
                            d.children = d._children;
                            d._children = null;
                        }
                        update();
                    }
                });

            node.append('circle')
                .attr('r', 6);

            node.append('text')
                .attr('dy', '0.31em')
                .attr('x', d => d.x < Math.PI === !d.children ? 8 : -8)
                .attr('text-anchor', d => d.x < Math.PI === !d.children ? 'start' : 'end')
                .attr('transform', d => d.x >= Math.PI ? 'rotate(180)' : null)
                .text(d => d.data.name);
        }

        function expandAll() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            update();
        }

        function collapseAll() {
            root.descendants().forEach(d => {
                if (d.children && d.depth > 0) {
                    d._children = d.children;
                    d.children = null;
                }
            });
            update();
        }

        function resetView() {
            svg.transition()
                .duration(750)
                .call(zoom.transform, d3.zoomIdentity);
        }

        document.getElementById('orientation').addEventListener('change', update);

        // SVG Export function
        function exportSVG() {
            // Clone the SVG
            const svgElement = document.getElementById('tree');
            const clone = svgElement.cloneNode(true);
            
            // Get computed styles and inline them
            const computedStyles = getComputedStyle(document.documentElement);
            const cssVars = {
                '--primary': computedStyles.getPropertyValue('--primary'),
                '--primary-light': computedStyles.getPropertyValue('--primary-light'),
                '--text': computedStyles.getPropertyValue('--text'),
                '--text-muted': computedStyles.getPropertyValue('--text-muted')
            };
            
            // Add styles inline for standalone SVG
            const styleElement = document.createElementNS('http://www.w3.org/2000/svg', 'style');
            styleElement.textContent = `
                .node circle { fill: ${cssVars['--primary'].trim()}; stroke: ${cssVars['--primary-light'].trim()}; stroke-width: 3px; }
                .node.collapsed circle { fill: ${cssVars['--text-muted'].trim()}; stroke: ${cssVars['--text'].trim()}; }
                .node text { font-family: system-ui, -apple-system, sans-serif; font-size: 14px; font-weight: 500; fill: ${cssVars['--text'].trim()}; }
                .link { fill: none; stroke: ${cssVars['--text-muted'].trim()}; stroke-width: 2px; }
            `;
            clone.insertBefore(styleElement, clone.firstChild);
            
            // Add XML declaration and doctype
            const serializer = new XMLSerializer();
            let svgString = serializer.serializeToString(clone);
            svgString = '<?xml version="1.0" encoding="UTF-8"?>\n' + svgString;
            
            // Create download
            const blob = new Blob([svgString], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'hierarchy.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Initial render
        update();
    </script>
</body>
</html>
