<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concept Map - Cytoscape.js</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape-svg/0.4.0/cytoscape-svg.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --background: #ffffff;
            --surface: #f8fafc;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            
            /* Category colors - customize as needed */
            --cat-1: #10b981; /* Green */
            --cat-2: #8b5cf6; /* Purple */
            --cat-3: #ec4899; /* Pink */
            --cat-4: #f59e0b; /* Orange */
            --cat-5: #ef4444; /* Red */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: var(--text);
            background: var(--surface);
            padding: 20px;
        }

        .header {
            max-width: 1400px;
            margin: 0 auto 20px;
            text-align: center;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 18px;
        }

        .controls {
            max-width: 1400px;
            margin: 0 auto 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }

        button:hover {
            background: var(--primary-light);
        }

        .layout-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }

        .legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .visualization-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        #cy {
            width: 100%;
            height: calc(100vh - 280px);
            min-height: 600px;
        }

        .tooltip {
            position: absolute;
            background: var(--text);
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 14px;
            max-width: 300px;
            line-height: 1.4;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tooltip.visible {
            opacity: 1;
        }

        .instructions {
            max-width: 1400px;
            margin: 20px auto 0;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .instructions h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .instructions ul {
            margin-left: 20px;
            color: var(--text-muted);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Concept Map Template</h1>
        <p class="subtitle">Interactive network visualization</p>
    </div>

    <div class="controls">
        <div style="display: flex; gap: 8px; align-items: center;">
            <label for="layout-select" style="font-size: 14px; color: var(--text-muted);">Layout:</label>
            <select id="layout-select" class="layout-select">
                <option value="cose">COSE (Force-Directed)</option>
                <option value="cola">Cola (Constrained)</option>
                <option value="dagre">Dagre (Hierarchical)</option>
                <option value="breadthfirst">Breadth-First</option>
                <option value="circle">Circle</option>
                <option value="grid">Grid</option>
                <option value="concentric">Concentric</option>
            </select>
        </div>
        <button onclick="resetView()">Reset View</button>
        <button onclick="fitToView()">Fit to View</button>
        <button onclick="exportSVG()">Export SVG</button>
    </div>

    <div class="controls">
        <div class="legend" id="legend"></div>
    </div>

    <div class="visualization-container">
        <div id="cy"></div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div class="instructions">
        <h3>How to Use This Template:</h3>
        <ul>
            <li>Modify the <code>nodes</code> and <code>edges</code> arrays in the script below</li>
            <li>Each node has: id, label, category, description</li>
            <li>Each edge has: source, target, label</li>
            <li>Categories automatically color-code nodes</li>
            <li>Hover over nodes/edges to see descriptions</li>
            <li>Drag nodes to adjust positioning</li>
            <li>Scroll to zoom, drag background to pan</li>
            <li>Try different layouts to find the best fit</li>
        </ul>
    </div>

    <script>
        // =================================================================
        // DATA STRUCTURE - MODIFY THIS SECTION
        // =================================================================

        const nodes = [
            { id: 'node1', label: 'Concept 1', category: 'cat1', description: 'Description of concept 1' },
            { id: 'node2', label: 'Concept 2', category: 'cat1', description: 'Description of concept 2' },
            { id: 'node3', label: 'Concept 3', category: 'cat2', description: 'Description of concept 3' },
            { id: 'node4', label: 'Concept 4', category: 'cat2', description: 'Description of concept 4' },
            { id: 'node5', label: 'Concept 5', category: 'cat3', description: 'Description of concept 5' },
        ];

        const edges = [
            { source: 'node1', target: 'node2', label: 'enables' },
            { source: 'node1', target: 'node3', label: 'requires' },
            { source: 'node2', target: 'node4', label: 'leads to' },
            { source: 'node3', target: 'node4', label: 'depends on' },
            { source: 'node4', target: 'node5', label: 'creates' },
        ];

        const categories = {
            'cat1': { name: 'Category 1', color: '#10b981' },
            'cat2': { name: 'Category 2', color: '#8b5cf6' },
            'cat3': { name: 'Category 3', color: '#ec4899' },
            'cat4': { name: 'Category 4', color: '#f59e0b' },
            'cat5': { name: 'Category 5', color: '#ef4444' },
        };

        // =================================================================
        // VISUALIZATION CODE - NO NEED TO MODIFY
        // =================================================================

        // Build legend
        const legend = document.getElementById('legend');
        const usedCategories = new Set(nodes.map(n => n.category));
        usedCategories.forEach(catId => {
            const cat = categories[catId];
            if (cat) {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <div class="legend-color" style="background: ${cat.color};"></div>
                    <span>${cat.name}</span>
                `;
                legend.appendChild(item);
            }
        });

        // Initialize Cytoscape
        const cy = cytoscape({
            container: document.getElementById('cy'),
            
            elements: [
                // Nodes
                ...nodes.map(node => ({
                    data: {
                        id: node.id,
                        label: node.label,
                        category: node.category,
                        description: node.description
                    }
                })),
                // Edges
                ...edges.map(edge => ({
                    data: {
                        id: `${edge.source}-${edge.target}`,
                        source: edge.source,
                        target: edge.target,
                        label: edge.label
                    }
                }))
            ],

            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'background-color': function(ele) {
                            const cat = ele.data('category');
                            return categories[cat]?.color || '#64748b';
                        },
                        'color': '#ffffff',
                        'font-size': '14px',
                        'font-weight': '500',
                        'text-wrap': 'wrap',
                        'text-max-width': '120px',
                        'width': '80px',
                        'height': '80px',
                        'border-width': '3px',
                        'border-color': function(ele) {
                            const cat = ele.data('category');
                            const color = categories[cat]?.color || '#64748b';
                            return color;
                        },
                        'padding': '10px',
                        'shape': 'roundrectangle'
                    }
                },
                {
                    selector: 'node:hover',
                    style: {
                        'border-width': '4px',
                        'border-opacity': 1,
                        'background-opacity': 0.9
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#64748b',
                        'target-arrow-color': '#64748b',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'label': 'data(label)',
                        'font-size': '11px',
                        'color': '#64748b',
                        'text-background-color': '#ffffff',
                        'text-background-opacity': 0.9,
                        'text-background-padding': '3px',
                        'text-rotation': 'autorotate',
                        'edge-text-rotation': 'autorotate'
                    }
                },
                {
                    selector: 'edge:hover',
                    style: {
                        'width': 3,
                        'line-color': '#2563eb',
                        'target-arrow-color': '#2563eb',
                        'color': '#2563eb'
                    }
                }
            ],

            layout: {
                name: 'cose',
                animate: true,
                animationDuration: 500,
                nodeRepulsion: 8000,
                idealEdgeLength: 150,
                edgeElasticity: 100,
                nestingFactor: 1.2,
                gravity: 1,
                numIter: 1000,
                initialTemp: 200,
                coolingFactor: 0.95,
                minTemp: 1.0
            },

            wheelSensitivity: 0.2,
            minZoom: 0.3,
            maxZoom: 3
        });

        // Tooltip functionality
        const tooltip = document.getElementById('tooltip');

        cy.on('mouseover', 'node', function(evt) {
            const node = evt.target;
            const description = node.data('description');
            if (description) {
                tooltip.textContent = description;
                tooltip.classList.add('visible');
            }
        });

        cy.on('mousemove', 'node', function(evt) {
            tooltip.style.left = (evt.originalEvent.pageX + 15) + 'px';
            tooltip.style.top = (evt.originalEvent.pageY + 15) + 'px';
        });

        cy.on('mouseout', 'node', function() {
            tooltip.classList.remove('visible');
        });

        cy.on('mouseover', 'edge', function(evt) {
            const edge = evt.target;
            const label = edge.data('label');
            if (label) {
                tooltip.textContent = label;
                tooltip.classList.add('visible');
            }
        });

        cy.on('mousemove', 'edge', function(evt) {
            tooltip.style.left = (evt.originalEvent.pageX + 15) + 'px';
            tooltip.style.top = (evt.originalEvent.pageY + 15) + 'px';
        });

        cy.on('mouseout', 'edge', function() {
            tooltip.classList.remove('visible');
        });

        // Layout switching
        document.getElementById('layout-select').addEventListener('change', function(e) {
            const layoutName = e.target.value;
            const layoutOptions = {
                name: layoutName,
                animate: true,
                animationDuration: 500
            };

            // Add layout-specific options
            if (layoutName === 'cose') {
                Object.assign(layoutOptions, {
                    nodeRepulsion: 8000,
                    idealEdgeLength: 150,
                    edgeElasticity: 100
                });
            } else if (layoutName === 'cola') {
                Object.assign(layoutOptions, {
                    nodeSpacing: 100,
                    edgeLength: 150
                });
            } else if (layoutName === 'dagre') {
                Object.assign(layoutOptions, {
                    rankDir: 'TB',
                    nodeSep: 100,
                    rankSep: 150
                });
            } else if (layoutName === 'breadthfirst') {
                Object.assign(layoutOptions, {
                    directed: true,
                    spacingFactor: 1.5
                });
            } else if (layoutName === 'concentric') {
                Object.assign(layoutOptions, {
                    minNodeSpacing: 100
                });
            }

            cy.layout(layoutOptions).run();
        });

        // Control functions
        function resetView() {
            cy.zoom(1);
            cy.center();
        }

        function fitToView() {
            cy.fit(null, 50);
        }

        // SVG Export function
        function exportSVG() {
            const svgContent = cy.svg({
                full: true,
                scale: 1,
                bg: '#ffffff'
            });
            
            const blob = new Blob([svgContent], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'concept-map.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Initial fit
        setTimeout(() => {
            cy.fit(null, 50);
        }, 600);
    </script>
</body>
</html>
